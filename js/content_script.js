(()=>{"use strict";var t=function(t,e,n,o){return new(n||(n=Promise))((function(i,c){function r(t){try{a(o.next(t))}catch(t){c(t)}}function s(t){try{a(o.throw(t))}catch(t){c(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}a((o=o.apply(t,e||[])).next())}))};let e;const n={};window.recentContents=n;const o=()=>t(void 0,void 0,void 0,(function*(){try{if(!e)return;const o=e.find((t=>(location.pathname+location.search).match(new RegExp(t.pathPattern))));if(!o)return;const i=document.querySelector(o.injectedDomPath),s=document.querySelector(o.contentDomPath);if(!s){const t=null==i?void 0:i.querySelector(".vsoc-injected-button");return n[o.contentDomPath]="",void(t&&t.remove())}const a=s.innerText.trim();if(!a||n[o.contentDomPath]===a)return;if(!i)return;let d=i.querySelector(".vsoc-injected-button");d?d.dataset.text=a:(d=document.createElement("a"),d.className="vsoc-injected-button",d.dataset.text=a,d.onclick=()=>t(void 0,void 0,void 0,(function*(){if(!d.classList.contains("processing")){d.classList.add("processing");try{yield c(),yield(200,new Promise((t=>setTimeout((()=>t()),200)))),yield r("Phân tích và xử lý cảnh báo sau: "+d.dataset.text),d.remove()}finally{d.classList.remove("processing")}}})),i.appendChild(d)),n[o.contentDomPath]=a}finally{setTimeout(o,1e3)}})),i=e=>t(void 0,void 0,void 0,(function*(){return yield chrome.runtime.sendMessage(e)})),c=()=>i({type:"open_side_panel"}),r=t=>i({type:"monitored_content",text:t});window.addEventListener("load",(()=>t(void 0,void 0,void 0,(function*(){var t;try{const n=yield i({type:"get_settings"}),c=null===(t=null==n?void 0:n.value)||void 0===t?void 0:t.find((t=>t.domain==location.host));c&&(t=>{e=t.monitor,o()})(c)}catch(t){console.log(t)}}))))})();
